#include <iostream>
#include <fstream>
#include <string>

#define SURNAME    500
#define NAME       500
#define GROUP      500
#define MONTH      500
#define BUFFERSIZE 500

using namespace std;

ofstream fout;
ifstream fin;

struct Fio {
	char* surname;
	char* name;
    Fio() {
        surname = new char[SURNAME];
        name = new char[NAME];
    }
    ~Fio() {
        delete[] surname;
        delete[] name;
    }
};

struct Date {
    int day;
    char* month;
    int year;
    Date() {
        day = 0;
        month = new char[MONTH];
        year = 0;
    }
    ~Date() {
        delete[] month;
    }
};

struct Group {
    char* group;
    int groupnumber;
    Group() {
        group = new char[GROUP];
        groupnumber = 0;
    }
    ~Group() {
        delete[] group;
    }
};

struct Student {
    const int size = 100;
    Fio* fio = new Fio[size];
    Date* date = new Date[size];
    Group* gr = new Group[size];
};

void ClearBuffer(void) {
    fseek(stdin, 0, SEEK_END);
}

void InputString(char* dest, const char* msg) {
    cout << msg;
    ClearBuffer();
    char buff[BUFFERSIZE] = { };
    fgets(buff, BUFFERSIZE, stdin);
    strcpy_s(dest, sizeof(buff), buff);
}

void OpeningFileRecording() {
    fout.open("Students.txt", ofstream::app);
    if (!fout.is_open()) {
        cout << "Failed to open file for writing";
    }
    else {
        cout << "File successfully opened for writing\n\n";
    }
}

void ClosingFileRecording() {
    fout.close(); 
}

void OpeningFileRead() {
    fin.open("Students.txt");
    if (!fin.is_open()) {
        cout << "Failed to open file for writing";
    }
    else {
        cout << "File successfully opened for writing\n\n";
    }
}

void ClosingFileRead() {
    fin.close();
}

int AddingNewStudent(Student* stud, int i) {
    OpeningFileRecording();
    cout << "Student number " << i + 1 << endl;
    //
    InputString(stud->fio[i].surname, "Surname:      ");
    fout << stud->fio[i].surname;
    //
    InputString(stud->fio[i].name,    "name:         ");
    fout << stud->fio[i].name;
    //
    cout << "Day:          "; 
    cin >> stud->date[i].day;
    fout << stud->date[i].day << endl;
    //
    InputString(stud->date[i].month,  "Month:        ");
    fout << stud->date[i].month;
    //
    cout << "Year:         "; 
    cin >> stud->date[i].year;
    fout << stud->date[i].year << endl;
    //
    InputString(stud->gr[i].group, "Group:        ");
    fout << stud->gr[i].group;
    //
    cout << "Group number: "; 
    cin >> stud->gr[i].groupnumber;
    fout << stud->gr[i].groupnumber << endl;
    ClosingFileRecording();
    system("cls");
    i++;
    return i;
}

void OutputtingInformationTable(Student* student) {
    int number = 0;
    cout << "--------------------------" << endl;
    cout << "Enter student number: "; cin >> number;
    cout << "--------------------------" << endl;
    cout << "Surname        |" << student->fio [number - 1].surname;
    cout << "Name           |" << student->fio [number - 1].name;
    cout << "Day            |" << student->date[number - 1].day << endl;
    cout << "Month          |" << student->date[number - 1].month;
    cout << "Year           |" << student->date[number - 1].year << endl;
    cout << "Group          |" << student->gr  [number - 1].group;
    cout << "Number of group|" << student->gr  [number - 1].groupnumber << endl;
    cout << "--------------------------" << endl;
}

int FileDataProcessing(Student* stud, int number) {
    OpeningFileRead();
    string str;
    while (!fin.eof()) {
        str = "";
        getline(fin, str);
    }
    ClosingFileRead();
    return number;
}

int WorkingWithTheUser(Student* student, int number) {
    int client = NULL;
    while (client != 1) {
        cout << "Finish the operation                                        - [1]" << endl;
        cout << "Add information about a new student                         - [2]" << endl;
        cout << "Print out the information about the student in tabular form - [3]" << endl;
        cout << "Enter the transaction number: ";
        scanf_s("%d", &client);
        system("cls");
        switch (client) {
        case 1: {
            break;
        }
        case 2: {
            number = AddingNewStudent(student, number);
            break;
        }
        case 3: {
            OutputtingInformationTable(student);
            break;
        }
        }
    }
    return number;
}

int main() {
    /*
    * Инициализация структуры для 100 пользователей
    */
    const int size = 100;
    Student* student = new Student[size];
    /*
    * Инициализация считывания данных из файла перед работой пользователя с ними
    */
    int number = 0;
    number = FileDataProcessing(student, number);
    /*
    * Инициализация работы пользователя с данными структуры
    */
    number = WorkingWithTheUser(student, number);
}
